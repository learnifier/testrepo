[#ftl strip_text="true" /]

[#assign foot]

${cpweb_foot}

<script>
    
    var listDeeplinksProducts = {};
    
    listDeeplinksProducts.listPurchasedMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listPurchasedMats',[org.id])}?exclude=project,orgunit";
    listDeeplinksProducts.listLinksUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','listPurchasedMatLinks',[org.id])}";
    listDeeplinksProducts.listLinksHistoryUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','listLinkTokens')}";
    listDeeplinksProducts.toggleActiveUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','changeLinkStatus')}";
    listDeeplinksProducts.toggleActiveToUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','changeLinkActiveTo')}";
    listDeeplinksProducts.toggleAutoaddUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','changeAutoAddStatus')}";
    listDeeplinksProducts.newOrgMatUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','newProdLink',[org.id])}";
    listDeeplinksProducts.deleteOrgMatLinkUrl = "${helper.urlFor('deeplink.ProductMaterialJsonModule','deleteLink',[org.id])}";
    listDeeplinksProducts.contextPath = "${contextPath}";
    listDeeplinksProducts.sLang = "Search purchased materials";
    listDeeplinksProducts.creditBalance = "${helper.urlFor('deeplink.ProductMaterialJsonModule','productBalance',[org.id])}";
    listDeeplinksProducts.updateCredits = "${addLinkCreditsFormLink}";
    listDeeplinksProducts.orgId = "${org.id?c}";

   require(['${contextPath}/js/deeplink/listProdDeeplinks.js?${cycle.application.formattedStartTime.base36String}'],function(){
       
   });
    </script>

[/#assign]


[@dws.skin skin="CPAuth3" head=cpweb_head foot=foot]

<div class="container-fluid">
 
<div class="list-group" data-bind="foreach: materials" style="height: auto;">

    <div class="list-group-item" style="min-height: 130px;">

        <img class="img-thumbnail pull-left" data-bind="attr:{src: thumbnail}" style="height: 100px; width: 100px; margin-right: 25px;">
        
        <button type="button" class="btn btn-primary-outlined pull-right" data-bind="click: toggleLinkSection, text: buttonStatus"></button>
        <small class="pull-right" style="clear:right; margin-right:6px; margin-top:3px; color:#999;">Active Links</small>
        <p class="pull-right" style="clear:right; margin-right:19px; margin-top:3px; margin-bottom:0px; font-weight: bold;"><span data-bind="text: activeLinks"></span> of <span data-bind="text: inactiveLinks"></span></p>
        <small class="pull-right" style="clear:right; margin-right:-4px; color:#999;">Assigned credits</small>
        <p class="pull-right" style="clear:right; margin-right:34px; margin-top:3px; margin-bottom:0px; font-weight: bold;"><span data-bind="text: linkCredits"></span></p>
        
    <h4 class="list-group-item-heading" data-bind="text: title" style="color:#5AB9D2;"></h4>
    <p class="list-group-item-text" data-bind="text: description" style="max-width: 52%; display: flex;"></p>
    </div>
    <!-- ko if: linkSectionVisible -->
    <div data-bind="foreach: links" style="height: auto;">
    <div class="list-group-item" style="overflow-y: hidden; background-color: #f5f5f5; border:1px solid #e3e3e3;">
        
        <h4 class="list-group-item-heading" style="margin-bottom: 25px;">Link <span style="color:black; font-size:58%;">&nbsp; Edit link title</span></h4>

        <div class="pull-left" style="margin-right: 100px;">
            <!--<p class="list-group-item-text" style="color:#666;">Active</p>
            <p style="margin-top: 6px;">ON / OFF</p>-->
            <p class="list-group-item-text pull-left" style="margin-right: 100px;">
                <input type="checkbox" data-bind="ccbBootstrapToggle: active, ccbBootstrapToggleClick: toggleStatus" />Active</p>
        </div>
        <div class="pull-left" style="margin-right: 100px;">
            <p class="list-group-item-text" style="color:#666;">Assigned Credits</p>
            <p data-bind="text: balance" class="pull-left" style="margin-right: 23px; margin-top: 6px; margin-bottom: 0px;"></p>
            <button type="button" class="btn btn-default btn-xs pull-left" style="margin-top: 5px;" data-toggle="modal" data-target="#myModal" data-bind="click: showAddCreditsModel.bind($data, $parent, $root)">Add Credits</button>
            <small class="pull-left" style="clear: left; margin-right: 10px; color: #5AB9D2; margin-top: 5px;" data-bind="click: toggleCreditHistorySection">Credit history</small>
        </div>
        <div class="pull-left">
            <p class="list-group-item-text" style="color:#666;">Active Until</p>
            <!--<p data-bind="text: activeto" style="margin-top: 6px;"></p>-->
            <span data-bind="text: activeUntilString, attr: {'data-pk': linkid, 'data-value': activeto}, ccbEditable: activeto, ccbEditableOpts: {display: dateDisplay}"
                      data-type="ccbdate"
                      data-placement="bottom"
                      data-showbuttons="bottom"
                      data-container="body"
                      data-url="${helper.urlFor('deeplink.ProductMaterialJsonModule','changeLinkActiveTo')}"
                      />
        </div>
        
        <!-- ko if: creditSectionVisible -->
        <div class="pull-left" style="clear:left; margin-bottom: 10px;">
            <p class="list-group-item-text" style="color:#666;">Credit history</p>
            <div style="padding:5px; background: white;">
            <p class="list-group-item-text pull-left">Quantity</p>
            <p class="list-group-item-text pull-left" style="margin-left: 97px;">Added By</p>
            <p class="list-group-item-text pull-left" style="margin-left: 149px; margin-right: 180px;">Added Date</p>
            <hr style="margin-bottom: 0px !important;">
            
            <div data-bind="foreach: credits">
            <p style="margin-top: 5px; width: 60px; margin-bottom: 0px;" class="pull-left" data-bind="text: amount"></p>
            <p style="margin-top: 5px; margin-left: 92px; width: 170px; margin-bottom: 0px;" class="pull-left" data-bind="text: createdBy"></p>
            <p style="margin-top: 5px; margin-left: 40px; margin-right: 75px; margin-bottom: 0px; min-width: 110px;" class="pull-left" data-bind="text: createdStr"></p>
            <button type="button" class="btn btn-default btn-xs" style="margin-top: 5px;">Delete</button>
            <hr style="margin-top: 5px !important; margin-bottom: 0px !important;">
            </div>
            
            <div data-bind="if: credits() == 0">
             <p style="margin-bottom: 0px; text-align: center; margin-top: 5px;">- This link has no credit history -</p>
            </div>
            </div>
        </div>
        <!-- /ko -->
      
        
        <div class="pull-left" style="clear:left; width: 100%;">
            <p class="list-group-item-text" style="color:#666;">URL</p>
            <input type="text" class="form-control" style="max-width: 40%;" data-bind="value: url">
            <div data-bind="if: defaultLink() == false">
                <button type="button" class="btn btn-default btn-xs pull-left" style="margin-top: 5px;" data-bind="click: deleteLink.bind($data, $parent)">Delete Link</button>
            </div>
        </div>
    </div>
         
    </div>
    
    <div style="width: 100%; overflow-y: hidden; border-left: 1px solid #e3e3e3; border-right: 1px solid #e3e3e3; padding:10px; background-color: #f5f5f5;">
        <button type="button" class="btn btn-default btn-sm" style="margin-top: 5px;" data-bind="click: addLink">Add Link</button>
    </div>
     <!-- /ko -->
     
    
</div>
         
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-bind="with: addLinkModel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel" style="color: #5AB9D2;">ADD CREDITS TO LINK</h4>
        <p>Type the number of credits that you would like to add to this link.</p>
      </div>
      <div class="modal-body">
          <p>Available credits: <span data-bind="text: $root.creditsLeft"></span></p>
          <p>Number of credits to add</p>
          <input type="number" id="creditsVal" tabindex="1" required="required" autofocus="autofocus">
          <p id="cand" class="text-danger"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" data-bind="click: addNewCredits">Add credits to Link</button>
      </div>
    </div>
  </div>
</div>
 
[/@dws.skin]

