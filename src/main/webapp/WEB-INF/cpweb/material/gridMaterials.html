[#ftl strip_text="true" /]

[#import "/material/materialsMenu.html" as mMenu /]

[#assign head]
${cpweb_head}
[/#assign]


[#assign pagetitle='gridMaterials' /]

[#assign foot]
${cpweb_foot}

<script id="video-partial" type="text/x-handlebars-template">
    <div class="video">
        <p class="title">{{title}}</p>
    </div>
</script>

<script id="audio-partial" type="text/x-handlebars-template">
    <div class="audio">
        <p class="title">{{title}}</p>
    </div>
</script>

<script id="file-partial" type="text/x-handlebars-template">
    <div class="file">
        <p class="title">{{title}}</p>
    </div>
</script>

<script id="general-partial" type="text/x-handlebars-template">
    <div class="general">
        <p class="title">{{title}}</p>
    </div>    
</script>


<script id="grid-entry-template" type="text/x-handlebars-template">
    
    <div id="grid-entries">
        {{#each aaData}}
        <div class="grid-entry" data-index="{{@index}}" data-type="{{type}}" data-materialtype="{{materialType}}">
            <div class="body" style="background-image: url('{{thumbnail}}')">
                <div class="info">
                    
                    {{#if_eq this.type 'vimeo2video'}}
                        {{> video}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'vimeovideo'}}
                        {{> video}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'brightcovevideo'}}
                        {{> video}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'audioplayer'}}
                        {{> audio}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'file'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'genericfile'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'pdf'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'powerpoint'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'idproject'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'daboxasmt'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    {{#if_eq this.type 'mobileapp'}}
                        {{> file}}
                    {{/if_eq}}
                    
                    
                </div>
                <div class="info-hover">
                
                    {{#if_eq this.materialType 'added'}}
                        <div class="settings clearfix">
                        
                            <div class="settings-button">
                                <div class="caret-button">
                                    <span class="caret"></span>
                                </div>
                            </div>
                        
                            <div class="settings-actions">
                                <a class="btn deletebutton" onclick="deleteOrgMat({{id}})">delete</a>
                                <a class="btn editbutton" href="${helper.urlFor('material.MaterialModule','edit',[org.id])}/{{id}}">edit</a>
                            </div> 
                        </div>
                    {{/if_eq}}
                    
                    <h1 class="title">
                        {{#if_eq this.materialType 'added'}}<a href="{{viewLink}}">{{/if_eq}}
                            {{title}}
                        {{#if_eq this.materialType 'added'}}</a>{{/if_eq}}
                    </h1>        
                    <p class="description">{{desc}}</p>
                </div>
        
                <div> 
                
                    
                </div> 
        
            </div>
        </div>
        {{/each}}
    </div>
</script>
     


<script>
                    
    
    /*
     
     listMaterialsProducts.listPurchasedMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listPurchasedMats',[org.id])}";
     listMaterialsProducts.newOrgMatUrl = "${helper.urlFor('material.ProductMaterialJsonModule','newProdLink',[org.id])}";
     listMaterialsProducts.deleteOrgMatLinkUrl = "${helper.urlFor('material.ProductMaterialJsonModule','deleteLink',[org.id])}";
     listMaterialsProducts.contextPath = "${contextPath}";
     listMaterialsProducts.sLang = "Search purchased materials";
     
     listMaterialsOrgMats.listOrgMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listOrgMats',[org.id])}";
     listMaterialsOrgMats.listPurchasedMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listPurchasedMats',[org.id])}";
     listMaterialsOrgMats.createOrgMatUrl =  "${helper.urlFor('CpMainModule','newMaterial',[org.id])}";
     listMaterialsOrgMats.editOrgMatUrl = "${helper.urlFor('material.MaterialModule','edit',[org.id])}";
     listMaterialsOrgMats.deleteOrgMatLinkUrl = "${helper.urlFor('OrgMaterialJsonModule','deleteOrgMatLink')}";
     listMaterialsOrgMats.deleteOrgMatUrl = "${helper.urlFor('OrgMaterialJsonModule','deleteOrgMat')}"
     listMaterialsOrgMats.contextPath = "${contextPath}";
     listMaterialsOrgMats.sLang = "Search added materials";
     
     */
    
    var listPurchasedMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listPurchasedMats',[org.id])}";
    var listOrgMatsUrl = "${helper.urlFor('OrgMaterialJsonModule','listOrgMats',[org.id])}";
    
    var deleteOrgMatUrl = "${helper.urlFor('OrgMaterialJsonModule','deleteOrgMat')}";
    var editOrgMatUrl = "${helper.urlFor('material.MaterialModule','edit',[org.id])}";
    
    var deleteOrgMat = function(orgMatId) {
        var ajaxData = {"orgmatid": orgMatId};
        var ajaxSettings = {};
        ajaxSettings.data = ajaxData;
        ajaxSettings.success = processDeleteOrgMatAjaxResponse;
        require(['dabox-common'], function() {
            cocobox.confirmationDialog("Delete material",
                    "Do you want to permanently delete this material?",
                    function() {
                        cocobox.ajaxPost(deleteOrgMatUrl, ajaxSettings);
                    }
            );
        });

    };
    
    var processDeleteOrgMatAjaxResponse = function(data) {
        log('Ajax response', data);

        if (data.status == "OK") {
            //Delete row with error
            deleteOrgMatRow(data);
        } else {
            displayDeleteOrgMatError(data);
        }
    };
   
    var displayDeleteOrgMatError = function(data) {
        var lines = [];
        lines.push("This material cannot be deleted due to the foilowing reason.");
        lines.push("");
        if (data.activeLinkCount > 0) {
            lines.push("This material has an active access link");
            lines.push();
        }

        var pns = data.linkedProjectNames;
        if (pns && pns.length > 0) {
            lines.push("This material is used in the following projects:");
            lines.push();
            for(var i = 0; i<pns.length; i++) {
                var pn = pns[i];
                lines.push(pn);
            }
        }

        cocobox.infoDialog("Unable to delete material", lines);
    };
    
    
</script>

<script src="${contextPath}/js/material/gridMaterials.js"></script>

[/#assign]

[#assign cpweb_ctxMenu]
[@mMenu.materialsMenu selected="materials"][/@mMenu.materialsMenu]
[/#assign]

[@dws.skin skin="CPAuthMenu2" head=head foot=foot ctxMenu=cpweb_ctxMenu orgName=orgName]
 
<a href="${helper.urlFor('CpMainModule','newMaterial',[org.id])}" class="btn btn-add navBackgroundColor">Add Material</a>
<h1>Materials</h1>

<div class='grid-header'>
    <div class='list-toggle'>[#include 'listToggle.html' /]</div>
    <div class='filter'>
        <ul class="grid-filter" id="materials-grid-filter">
            <li><a class="filter" data-filter="all">All</a></li>
            <li><a class="filter" data-filter="added">Added</a></li>
            <li><a class="filter" data-filter="purchased">Purchased</a></li>
            <li><a class="filter" data-filter="audio">Audio</a></li>
            <li><a class="filter" data-filter="video">Video</a></li>
            <li><a class="filter" data-filter="docs">Documents</a></li>
        </ul>
    </div>
</div>

<div id="materials-grid" class="grid-list">
</div>





[/@dws.skin]

