[#ftl strip_text="true" /]

[#import "projectInfo.html" as pInfo /]

[#assign cpweb_head]
${cpweb_head}

<!--[if lt IE 9]>
<style>

.toggle-button input {
    position: static; !important
}

</style>


<![endif]-->
[/#assign]

[#assign cpweb_foot ]
${cpweb_foot}
<script>
    
    
    
    "use strict";
    $('#tm_projects').addClass('activeItem').prev().addClass('prevItem');

    
    var settingsUrl = "${helper.urlFor('project.ProjectSettingsJsonModule', 'changeSetting',[prj.projectId])}";

    cpweb.editable($('#language .editable-content'), 
    $('#language .edit '),
    function(value){},
    {'type': 'select',
        'url': settingsUrl,
        'source': "${helper.urlFor('project.ProjectJsonModule','listLanguages',[prj.projectId])}",
        'pk': 'locale',
        'value': "${prj.locale.toLanguageTag()}"
    });

    cpweb.editable($('#country .editable-content'),
    $('#country .edit '),
    function(value){},
    {type: 'select',
        'url': settingsUrl,
        'source': "${helper.urlFor('project.ProjectJsonModule','listCountries',[prj.projectId])}",
        'pk': 'country',
        'value': "${prj.country.toLanguageTag()}"
    });
    
    cpweb.editable($('#timezone .editable-content'),
    $('#timezone .edit '),
    function(value){},
    {type: 'select',
        'url': settingsUrl,
        'source': "${helper.urlFor('project.ProjectJsonModule','listTimeZones',[prj.projectId])}",
        'pk': 'timezone',
        'value': "${prj.timezone.ID?js_string}"
    });
    
    cpweb.editable($('#expiration .editable-content'),
    $('#expiration .edit '),
    function(value){},
    {type: 'text',
        'url': settingsUrl,
        'pk': 'participationexpiration',
        'value': "${prj.participationExpiration!''}"
    });


    $(function(){
        require(['dabox-common'], function() {
            //cocobox.setlist.expandableList('#settingsList');
        });
    });

    var setIcal = function(autoIcal, sendUpdates) {
		
        $.ajax({
            type: 'POST',
            url: "${helper.urlFor('project.ProjectJsonModule','setAutoIcalStatus',[prj.projectId])}",
            data: {autoical: autoIcal, sendUpdates: sendUpdates},
            success: function(data) {
                log(data);
            }
        });
    }

    var setSocial = function(socialSetting) {

        $.ajax({
            type: 'POST',
            url: "${helper.urlFor('project.ProjectJsonModule','setSocialSetting',[prj.projectId])}",
            data: {enabled: socialSetting}
        });
    };


    $('#meeting-maker input').click( function() {
        var clicked = $(this).val();
	  
        if(clicked == 'true') {
            cocobox.confirmationDialog(
            'Turning calendar invitations ON',
            'As you turn this feature on, all participants will automatically receive calendar invitations via email, both as events are added, updated and deleted.' ,
            function() {
                setIcal(true, false);
            },
            function() {
                $('#meeting-maker-false').attr('checked', 'checked'); //do not activate the meeting maker. Check off settings input.
            }
        )
        } else {
            cocobox.confirmationDialogYesNo(
            'Turning calendar invitations OFF',
            'Do you want to send cancellations to previously sent calendar invitations?',
            function() {
                //log('Send cancels');
                setIcal(false, true);
            },
            function() {
                //log('No cancels');
                setIcal(false, false);
            }
        )
        }
    });

    $('#socialfeatures input').click( function() {
        var clicked = $(this).val();

        setSocial(clicked === 'true');
    });
</script>
[/#assign]

[#macro userNameAndEmail userId]


[#if infoHelper.getMiniUserInfo(userId)??]
[#local userInfo =  infoHelper.getMiniUserInfo(userId) /]
${userInfo.displayName?xml} &lt;${userInfo.email?xml!''}&gt;
[/#if]

[/#macro]

[@dws.skin skin="CPAuth2" head=cpweb_head ctxMenu=cpweb_ctxMenu foot=cpweb_foot orgName=orgName]

[@pInfo.projectInfo selected="settings"][/@pInfo.projectInfo]

<h2>Information</h2>
<div class="itemdetails">    
    <ul>
        <li>
            <span class="label">Created by:</span><span class="setting">[@userNameAndEmail prj.updatedBy /]</span>
        </li>
        <li>
            <span class="label">Created:</span><span class="setting">${(prj.created?datetime?string.full)!''}</span>
        </li>
        <li>
            <span class="label">Last updated by:</span><span class="setting">[@userNameAndEmail prj.updatedBy /]</span>
        </li>
        <li>
            <span class="label">Last updated:</span><span class="setting">${(prj.updated?datetime?string.full)!''}</span>
        </li>        
    </ul>
</div>

<div id="settingsList">
    <h2>[@dws.txt key="cpweb.project.settings.title" /]</h2>
    <ul>
        [@dwsrt.feature feature="autoical"]
        [#-- Only for Course design projects --]
        [#if prj.type.ptype == 2]
        <li id="meeting-maker">
            <a class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.meetingmaker.title" /]</span>
                [@mbform.inputBoolean 'meeting-maker' 'Meeting Maker Setting' 'ON' 'OFF' prj.autoIcal?string session=formsess /]
            </a>
        </li>
        [/#if]
        [/@dwsrt.feature]

        <li id="language">
            <span class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.language.title" /]</span>
                <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                <span class="short editable-content">${prj.locale.getDisplayName(userLocale)?xhtml}</span>
            </span>
        </li>
        <li id="country">
            <span class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.country.title" /]</span>
                <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                <span class="short editable-content">${prj.country.getDisplayCountry(userLocale)?xhtml}</span>
            </span>
        </li>
        <li id="timezone">
            <span class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.timezone.title" /]</span>
                <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                <span class="short editable-content">${prj.timezone.getDisplayName(userLocale)?xhtml}</span>
            </span>
        </li>
        <li id="expiration">
            <span class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.expiration.title" /]</span>
                <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                <span class="short editable-content">${prj.defaultParticipationExpiration!''}</span>
            </span>
        </li>

        [@dwsrt.feature feature="social"]
        [#-- Only for Course design projects --]
        [#if prj.type.ptype == 2]
        <li id="socialfeatures">
            <a class="setting">
                <span class="label">[@dws.txt key="cpweb.project.settings.social.title" /]</span>
                [@mbform.inputBoolean 'socialfeatures' 'Social features' 'ON' 'OFF' prj.social?string session=formsess /]
            </a>
        </li>
        [/#if]
        [/@dwsrt.feature]
    </ul>
</div>

[/@dws.skin]

