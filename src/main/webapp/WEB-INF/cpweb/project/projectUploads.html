[#ftl strip_text="true" /]

[#import "projectInfo.html" as pInfo /]

[#assign cpweb_head]
${cpweb_head}

[/#assign]

[#assign cpweb_foot ]
${cpweb_foot}
<script>
    "use strict";
    $('#menu-projects').addClass('active');

    var settings = {
        listUploadsUrl: "${helper.urlFor('project.upload.UploadJsModule', 'listUploads',[prj.projectId])}"
    };

    require(['messenger', 'es6-shim'], function() {
        $.getJSON(settings.listUploadsUrl).done(function(data) { // TODO: Should go handlebars here.            console.log("This is the dta:", data);
            if(data.status == "ok") {
                var $list = $("<ul/>")
                data.result.forEach(function(participant){
                    var $entry = $("<li/>").text(participant.participantName);
                    if(participant.uploads) {
                        console.log("uploads:", participant.uploads);
                        var $uploadEntry = $("<ul/>");
                        participant.uploads.forEach(function(upload){
                            console.log("...");
                           $uploadEntry.append($("<li/>").html(upload.fileName + ' <span class="glyphicon glyphicon-trash"></span>'));
                        });
                        $entry.append($uploadEntry);
                    }
                    $list.append($entry);
                    console.log("Participant:", participant, $entry);

                });
                $("#downloads-container").html($list);

            }
        }).fail(function(jqXHR, textStatus, errorThrown){
            console.log("Could not fetch uploads: ", errorThrown);
            CCBMessengerError("Could not fetch uploaded files.");
        });
    });

</script>


[/#assign]

[#assign title = (prj.name!'') + " uploads ("+orgName+")" /]
[@dws.skin skin="CPAuth3" head=cpweb_head ctxMenu=cpweb_ctxMenu foot=cpweb_foot orgName=title]

[@pInfo.projectInfo selected="uploads"][/@pInfo.projectInfo]


<h1>[@dws.txt key="cpweb.project.uploads.title" /]</h1>

<form method="POST" action="{helper.urlFor('project.ProjectModificationModule','assignRoleEmail',[prj.projectId])}" class="form">
    <div class="form-group">
        [@modal.formParams /]
        <button type="submit" class="btn btn-primary">A random button</button>
    </div>
</form>

<div class="row">
    <div class="col-sm-12">
        <div id="downloads-container">
            Downloads will appear here.
        </div>
    </div>
</div>

[/@dws.skin]

