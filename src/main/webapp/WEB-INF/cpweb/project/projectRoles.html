[#ftl strip_text="true" /]

[#import "projectInfo.html" as pInfo /]

[#assign cpweb_head ]
${cpweb_head}

<link rel='stylesheet' type='text/css' href='${cocoboxCdn}/cocobox/css/select2/select2.css'/>
<link rel='stylesheet' type='text/css' href='${cocoboxCdn}/cocobox/css/select2/select2-bootstrap.css'/>
[/#assign]


[#assign cpweb_foot ]
${cpweb_foot}
<script>
    $('#tm_projects').addClass('activeItem').prev().addClass('prevItem');
    
    require(['select2.min'], function()Â {
        
       $("#userSelect").select2({
            placeholder: "Search for a user",
            minimumInputLength: 1,
            ajax: { 
                url: "${helper.urlFor('project.role.ProjectRoleJsonModule', 'searchUser', [org.id])}",
                dataType: 'json',
                data: function (term, page) {
                    return {
                        term: term, // search term
                        page_limit: 10
                    };
                },
                results: function (data, page) { 
                    return {results: data.results};
                }
            },
            formatResult: function(data) {
                return '<span>' + data.text + '</span><br/><span>' + data.email + ' </span>' ;
            },
            formatSelection: function(data) {
                
                $('#userSelect').attr('value', data.id);
                
                return '<p value="' + data.id + '"> selected user: ' + data.text + '</p>';
            }
        }); 
    });
    
    
    function assign() {
        var id = $('#userSelect').val();
        log(id);
        
        var role = $('#userRole').val();
        log(role);
        
        $.ajax({
            url: "${helper.urlFor('project.ProjectModificationModule','assignRole',[prj.projectId])}",
            method: "POST",
            data: {
                userId: id,
                role: role
            },
            success: function(data) {
                log(data);
            }
        });
        
    }
    
    
</script>
[/#assign]

[@dws.skin skin="CPAuth2" head=cpweb_head ctxMenu=cpweb_ctxMenu foot=cpweb_foot orgName=orgName]

[@pInfo.projectInfo selected="projectadmin"][/@pInfo.projectInfo]

<h2>[@dws.txt key="cpweb.project.roles.title" /]</h2>

<form method="POST" action="${helper.urlFor('project.ProjectModificationModule','assignRole',[prj.projectId])}">
    <input name="userId" type="number" id="userSelect" class="bigdrop">

    
    [#list projectRoles?keys as pr]
    <label>${projectRoles[pr]}
    <input type="radio" name="role" value="${pr}">
    </label>
    [/#list]
    
    <button type="submit">Assign</button>    
</form>

[/@dws.skin]

