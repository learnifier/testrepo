[#ftl strip_text="true" /]

[#macro projectInfo selected project=prj]

[#assign projectSettingUrl = helper.urlFor('project.ProjectSettingsJsonModule', 'changeSetting',[project.projectId]) /]

[@mbform._onreadyJavascript]

    [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
    cpweb.editable($('#project-name .editable-content'), $('#project-name .editable-control'), function(value){}, {});
    cpweb.editable($('#project-desc .editable-content'), $('#project-desc .editable-control'), function(value){}, {type: 'textarea'});
    cpweb.editable($('#project-usertitle .editable-content'), $('#project-usertitle .editable-control'), function(value){});
    cpweb.editable($('#project-userdesc .editable-content'), $('#project-userdesc .editable-control'), function(value){}, {type: 'textarea'});

    cpweb.editable($('#project-status .editable-content'), $('#project-status .editable-control'), function(value){},
    {type: 'select',
        source: [
        {value: "NEW", text: '${ctext("project.status.NEW")?js_string}'},
        {value: "ACTIVE", text: '${ctext("project.status.ACTIVE")?js_string}'},
        {value: "DISABLED", text: '${ctext("project.status.DISABLED")?js_string}'}
        ]
    }
    );

    [/@]
[/@mbform._onreadyJavascript]


[#include "../projectDeleteFailure.html" /]
[#include "error/projectProductError.html" /]


<section id="projectinfo">
    <div id="itemactions">

        [#if projectSecurity.hasPermission("CP_DELETE_PROJECT") && !isIdproject() ]
            <form id="deleteprojectform" action="${helper.urlFor('project.ProjectModificationModule','deleteProject',[org.id,project.projectId])}" method="post">
                <button class="delete btn btn-primary"><span>Delete</span></button>
            </form>
        [/#if]
        [#if project.type.ptype == 2]
            <form action="${helper.urlFor('ProjectModule','previewDesign',[prj.projectId])}" method="post" target="_blank">
                <button class="delete btn btn-primary"><span>Preview</span></button>
            </form>
        [/#if]

        [#if isIdproject() ]
            <form action="${helper.urlFor('project.ProjectModule', 'roster',[project.masterProject])}" method="post">
                <button>Back to parent project</button>
            </form>
        [/#if]
        [@mbform._onreadyJavascript]
        require(['dabox-common'], function() {
        cocobox.ajaxForm("#deleteprojectform", function(data) {
        if (data.location) {
        window.location = data.location;
        } else {
        cocobox.infoDialog('Delete project','You need to delete all participants to be able to delete the project.');
        }
        });
        });
        [/@mbform._onreadyJavascript]
    </div>

    [#if isIdproject() ]

    <div class="itemicon">
        <p>Project</p>
        <h1>${(material.title?xhtml)!'Unknown product'} for ${infoHelper.getUserIdentifier((participationOwner.userId)!0)!''?xhtml}</h1>

        <p>invited by ${infoHelper.getUserIdentifier(project.createdBy)!''?xhtml}

            in ${masterProject.name}</p>

    </div>

    [#else]	

    <div class="itemicon">
        <p>Project</p><h1 id="project-name"><span class="editable-content" data-url="${projectSettingUrl}" data-pk="name">${project.name?xhtml}</span>[#include "projectEditLabel.html" /]</h1>
    </div>

    [/#if]
	
	
	
    [#if project.stageDesignId??]
        [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
            <div id="incomplete_dd">
                <h2>Activate Your Updated Course Design</h2>
                <p>Your updated course design <span class="imp">will not be available to participants </span>until you have clicked the button below and entered any required information.</p>

                [#if !prj.invitePossible]
                <p><span class="imp">You cannot invite participants until you have activated the course design.</span></p>
                [/#if]
                <form action="${helper.urlFor('project.VerifyProjectDesignModule','verifyNewDesign',[project.projectId])}" method="post">
                    <button type="submit" class="btn btn-primary" ><span>Activate Course Design Now</span></button>
                </form>
            </div>
        [/@]
    [/#if]
    <nav id="itemnav2">
        <ul class="nav nav-tabs">
            <li class="[#if selected == 'overview']active[/#if]"><a href="${helper.urlFor('ProjectModule','overview',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.overview' /]</span></a></li>
            <li class="[#if selected == 'participants']active[/#if]"><a href="${helper.urlFor('ProjectModule','roster',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.participants' /]</span></a></li>
 
            [#if project.type.ptype == 2 && !isIdproject(prj)]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
                <li class="[#if selected == 'details']active[/#if]"><a href="${helper.urlFor('VerifyProjectDesignModule','verifyNewDesignSecondary',[project.projectId])}"><span>Program<!--[@dws.txt key='cpweb.projectmenu.details' /]--></span></a></li>
            [/@]
            [/#if]

            [#if project.type.ptype == 1 || project.type.ptype == 2]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT_MATERIAL"]
            <li class="[#if selected == 'materials']active[/#if]"><a href="${helper.urlFor('ProjectModule','materials',[project.projectId])}"><span>Library<!--[@dws.txt key='cpweb.projectmenu.materials' /]--></span></a></li>
            [/@]
            [/#if]

            [#if !isIdproject(prj)]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT_TASK"]
            <li class="[#if selected == 'schedule']active[/#if]"><a href="${helper.urlFor('ProjectModule','task',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.schedule' /]</span></a></li>
            [/@]
            [/#if]
                        
            <li class="[#if selected == 'reports']active[/#if]"><a href="${helper.urlFor('ProjectModule','reports',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.reports' /]</span></a></li>

            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
            <li class="[#if selected == 'settings']active[/#if]"><a href="${helper.urlFor('ProjectModule','settings',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.settings' /]</span></a></li>
            [/@]
        </ul>
    </nav>
</section>


[/#macro]

[#function isIdproject project=prj ]

[#return project.subtype == 'idproject' /]

[/#function]