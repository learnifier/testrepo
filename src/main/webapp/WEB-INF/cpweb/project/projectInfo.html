[#ftl strip_text="true" /]

[#macro userNameAndEmail userId]
    [#if infoHelper.getMiniUserInfo(userId)??]
        [#local userInfo =  infoHelper.getMiniUserInfo(userId) /]
        <span data-toggle="tooltip" data-placement="top" title="${userInfo.displayName?xml} &lt;${userInfo.email?xml!''}&gt;">${userInfo.displayName?xml}</span>
    [#else]
        &nbsp;
    [/#if]
[/#macro]

[#macro projectInfo selected project=prj]

[#assign projectSettingUrl = helper.urlFor('project.ProjectSettingsJsonModule', 'changeSetting',[project.projectId]) /]

[@mbform._onreadyJavascript]

    [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
    cpweb.editable($('#project-name .editable-content'), $('#project-name .editable-control'), function(value){}, {});

    [/@]

    require(['dabox-common'], function() {
    cocobox.ajaxForm("#deleteprojectform", function(data) {
    if (data.location) {
    window.location = data.location;
    } else {
    cocobox.infoDialog('Delete project','You need to delete all participants to be able to delete the project.');
    }
    });
    });

[/@mbform._onreadyJavascript]

[#include "../projectDeleteFailure.html" /]
[#include "error/projectProductError.html" /]

<section class="ccb-page-header">
    <div class="ccb-page-header__actions">
        [#if projectSecurity.hasPermission("CP_DELETE_PROJECT") && !isIdproject() ]
            <form id="deleteprojectform" action="${helper.urlFor('project.ProjectModificationModule','deleteProject',[org.id,project.projectId])}" method="post">
                <button class="btn btn-primary-outlined"><span class="glyphicon glyphicon-trash"></span> Delete</button>
            </form>
        [/#if]
        [#if project.type.ptype == 2]
            <form action="${helper.urlFor('ProjectModule','previewDesign',[prj.projectId])}" method="post" target="_blank">
                <button class="btn btn-primary"><span class="glyphicon glyphicon-eye-open"></span> Preview</button>
            </form>
        [/#if]

        [#if isIdproject() ]
            <form action="${helper.urlFor('project.ProjectModule', 'roster',[project.masterProject])}" method="post">
                <button><span class="glyphicon glyphicon-chevron-left"></span> Back to parent project</button>
            </form>
        [/#if]
    </div>

    [#if isIdproject() ]
        <div class="ccb-page-header__info">
            <img class="page-thumbnail img-circle img-thumbnail" src="http://www.harborfinancialgroup.com/news-views/wp-content/uploads/2013/11/Learning.jpg" />
            <p class="page-title-label">Project</p>
            <h1 class="page-title" id="project-name">${(material.title?xhtml)!'Unknown product'} for ${infoHelper.getUserIdentifier((participationOwner.userId)!0)!''?xhtml}</h1>
            <p class="invited-info">invited by ${infoHelper.getUserIdentifier(project.createdBy)!''?xhtml} in ${masterProject.name}</p>
        </div>
    [#else]	
    <div class="ccb-page-header__info">
        <img class="page-thumbnail img-circle img-thumbnail" src="http://www.harborfinancialgroup.com/news-views/wp-content/uploads/2013/11/Learning.jpg" />
        <p class="page-title-label">Project</p>
        <h1 class="page-title" id="project-name"><span class="editable-content" data-url="${projectSettingUrl}" data-pk="name">${project.name?xhtml}</span>[#include "projectEditLabel.html" /]</h1>
        <ul class="page-created-updated__wrapper list-inline">
            <li>
                <p class="page-updated-label">Created</p><p class="page-updated">[@userNameAndEmail prj.createdBy /]<span data-toggle="tooltip" data-placement="top" title="${(prj.created?datetime?string.full)!''}">${(prj.created?date?string.full)!''}</span></p>
            </li>
            <li>
                <p class="page-updated-label">Updated</p><p class="page-updated">[@userNameAndEmail prj.updatedBy /] <span data-toggle="tooltip" data-placement="top" title="${(prj.updated?datetime?string.full)!''}">${(prj.updated?date?string.full)!''}</span></p>
            </li>
        </ul>
    </div>
    [/#if]
</section>

	
    [#if project.stageDesignId??]
        [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
            <div id="incomplete_dd">
                <h2>Activate Your Updated Course Design</h2>
                <p>Your updated course design <span class="imp">will not be available to participants </span>until you have clicked the button below and entered any required information.</p>

                [#if !prj.invitePossible]
                <p><span class="imp">You cannot invite participants until you have activated the course design.</span></p>
                [/#if]
                <form action="${helper.urlFor('project.VerifyProjectDesignModule','verifyNewDesign',[project.projectId])}" method="post">
                    <button type="submit" class="btn btn-primary" ><span>Activate Course Design Now</span></button>
                </form>
            </div>
        [/@]
    [/#if]
    <nav>
        <ul class="nav nav-underline">
            <li class="[#if selected == 'overview']active[/#if]"><a href="${helper.urlFor('ProjectModule','overview',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.overview' /]</span></a></li>
            <li class="[#if selected == 'participants']active[/#if]"><a href="${helper.urlFor('ProjectModule','roster',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.participants' /]</span></a></li>
 
            <li class="[#if selected == '']active[/#if]"><a href="${helper.urlFor('ProjectModule','materials',[project.projectId])}"><span>Info</span></a></li>
            [#if project.type.ptype == 2 && !isIdproject(prj)]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
                <li class="[#if selected == 'details']active[/#if]"><a href="${helper.urlFor('VerifyProjectDesignModule','verifyNewDesignSecondary',[project.projectId])}"><span>Course<!--[@dws.txt key='cpweb.projectmenu.details' /]--></span></a></li>
            [/@]
            [/#if]

            [#if project.type.ptype == 1 || project.type.ptype == 2]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT_MATERIAL"]
            <li class="[#if selected == 'materials']active[/#if]"><a href="${helper.urlFor('ProjectModule','materials',[project.projectId])}"><span>Resources<!--[@dws.txt key='cpweb.projectmenu.materials' /]--></span></a></li>
            [/@]
            [/#if]

            [#if !isIdproject(prj)]
            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT_TASK"]
            <li class="[#if selected == 'schedule']active[/#if]"><a href="${helper.urlFor('ProjectModule','task',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.schedule' /]</span></a></li>
            [/@]
            [/#if]
                        
            <li class="[#if selected == 'reports']active[/#if]"><a href="${helper.urlFor('ProjectModule','reports',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.reports' /]</span></a></li>

            [@projectSecurity.permissionBlock permission="CP_EDIT_PROJECT"]
            <li class="[#if selected == 'settings']active[/#if]"><a href="${helper.urlFor('ProjectModule','settings',[project.projectId])}"><span>[@dws.txt key='cpweb.projectmenu.settings' /]</span></a></li>
            [/@]
        </ul>
    </nav>

[/#macro]

[#function isIdproject project=prj ]

[#return project.subtype == 'idproject' /]

[/#function]