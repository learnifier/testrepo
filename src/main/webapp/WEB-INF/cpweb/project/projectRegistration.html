[#ftl strip_text="true" /]

[#import "projectInfo.html" as pInfo /]

[#assign cpweb_head]
${cpweb_head}
<!--[if lt IE 9]>
<script>
require(['IE9'], function() {
    
    log('will use ie9.js to support some much wanted css-selectors');

});
</script>
<![endif]-->
[/#assign]

[#assign cpweb_foot ]
${cpweb_foot}
<script>
    $('#tm_projects').addClass('activeItem').prev().addClass('prevItem');

    $(function(){
        require(['dabox-common', 'jquery.form', 'dabox-formbeanjs', 'jquery-ui'], function() {
            cocobox.setlist.expandableList('#settingsList');

                    [#if !pInfo.isIdproject(prj)] //
            $("#setregistrationpassword").ajaxForm(cocobox.getAjaxFormbeanHandler("setregistrationpassword", function() {
                cocobox.setlist.showInfo('#password_updated', 'Password protection changes saved', 'info')
                cocobox.setlist.closeExpanded("#setregistrationpassword");
            }));
                    [/#if]

                    [#if !pInfo.isIdproject(prj) || pInfo.isIdproject(prj) && security.isBoAdmin()]
            $("#reginvlimitform").ajaxForm(cocobox.getAjaxFormbeanHandler("reginvlimitform", function() {
                cocobox.setlist.showInfo('#creditlimit_updated', 'Participant limit changes saved', 'info')
                cocobox.setlist.closeExpanded("#reginvlimitform");
            }));
                    [/#if]

            $('#reg_status').buttonset().find("input").click(function() {
                cocobox.ajaxPost("${helper.urlFor('project.ProjectJsonModule','setInvitationStatus', [prj.projectId])}",{
                    data: {status: this.value}
                });
            })
        });
    });

    $("[name='status']").bootstrapSwitch();
</script>
[/#assign]

[@dws.skin skin="CPAuth3" head=cpweb_head ctxMenu=cpweb_ctxMenu foot=cpweb_foot orgName=orgName]
<section id="projectregistration">
    [@pInfo.projectInfo selected="registration"][/@pInfo.projectInfo]

    <h2>[@dws.txt key="cpweb.project.registration.title" /]</h2>

	
	
	[#if !pInfo.isIdproject(prj)]
    <h3>Registration status</h3>
    <div id="reg_status" class="reg_status">
        <input type="radio" value="true" class="statuson" name="status" id="srstateon" [#if prj.selfRegistrationEnabled]checked="checked"[/#if] /><label for="srstateon">OPEN</label>
        <input type="radio" value="false" class="statusoff" name="status" id="srstateoff" [#if !prj.selfRegistrationEnabled]checked="checked"[/#if] /><label for="srstateoff">CLOSED</label>
    </div>
	[/#if]
	
    <h3>Registration link to distribute to participants</h3>
    <input type="text" id="reg_link" class="input_full" value="${reglink}" />


    <div id="settingsList">
        <ul>
			
			
			[#if !pInfo.isIdproject(prj)]
            <li id="password" class="expandable">
                <a class="setting">
                    [#global formsess=passwordformsess]
                    [#global formPrefix="cpweb.registration.password" /]
                    [#assign defaultValue = formsess.getDefaultValue('passwordEnabled')!'false' /]
                    <span class="label">[@dws.txt key="cpweb.registration.password.title" /]</span>
                    <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                    <span class="updatedinfo" id="password_updated"></span>
                    <span class="short">[#if defaultValue == "true"]<span id="regpwstatus" class="on">ON</span>[#else]<span id="regpwstatus" class="off">OFF</span>[/#if]</span>
                </a>
                <div class="content">
                    <div class="label">[@dws.txt key="cpweb.registration.password.title" /]</div>
                    <div class="form">

                        <form action="${helper.urlFor('project.ProjectJsonModule','setInvitationPassword',[prj.projectId])}" id="setregistrationpassword" name="setregistrationpassword" class="fullpage" method="post">
                            [@mbform.alertsection]
                            [/@mbform.alertsection]
                            <section class="field clearfix">
                                <div class="column">
                                    <fieldset>

                                        [#assign defaultValue = formsess.getDefaultValue("passwordEnabled")!"false" /]
                                        [@mbform.select name="passwordEnabled" class="input_full" tabindex="1"]
                                        [@mbform.option value="true" defaultValue=defaultValue]ON[/@mbform.option]
                                        [@mbform.option value="false" defaultValue=defaultValue]OFF[/@mbform.option]
                                        [/@mbform.select]

                                        [@mbform.inputText name="password" class="input_full"  tabindex="2" /]

                                    </fieldset>
                                </div>
                            </section>
                            [@mbform.infosection]
                            [/@mbform.infosection]
                            <section class="action">
                                <button tabindex="100" class="primary save"><span>[@dws.txt key='form.action.savesetting' /]</span></button>
                                <a class="cancel" tabindex="101">[@dws.txt key="form.action.cancel" /]</a>
                            </section>

                        </form>

                    </div>
                </div>
            </li>
			[/#if]
			
			[#if !pInfo.isIdproject(prj) || pInfo.isIdproject(prj) && security.isBoAdmin()]
            <li id="creditstop" class="expandable">
                <a class="setting">
                    [#global formsess=creditlimitformsess]
                    [#global formPrefix="cpweb.registration.creditlimit" /]
                    [#assign defaultValue = formsess.getDefaultValue('creditLimitEnabled')!'false' /]
                    <span class="label">[@dws.txt key="cpweb.registration.creditlimit.title" /]</span>
                    <span class="edit">[@dws.txt key="cpweb.registration.edit" /]</span>
                    <span class="updatedinfo" id="creditlimit_updated"></span>
                    <span class="short">[#if defaultValue == "true"]<span id="reginvlimitstatus" class="on">ON</span>[#else]<span id="reginvlimitstatus" class="off">OFF</span>[/#if]</span>
                </a>
                <div class="content">
                    <div class="label">[@dws.txt key="cpweb.registration.creditlimit.title" /]</div>
                    <div class="form">
                        <form action="${helper.urlFor('project.ProjectJsonModule','setInvitationCreditLimit',[prj.projectId])}" id="reginvlimitform" name="reginvlimitform" class="fullpage" method="post">
                            [@mbform.alertsection]
                            [/@mbform.alertsection]
                            <section class="field clearfix">
                                <div class="column">
                                    <fieldset>


                                        [@mbform.select name="creditLimitEnabled" class="input_full" tabindex="1"]
                                        [@mbform.option value="true" defaultValue=defaultValue]ON[/@mbform.option]
                                        [@mbform.option value="false" defaultValue=defaultValue]OFF[/@mbform.option]
                                        [/@mbform.select]

                                        [@mbform.inputNumber name="creditLimit" class="input_full"  tabindex="2" /]

                                    </fieldset>
                                </div>
                            </section>
                            [@mbform.infosection]
                            [/@mbform.infosection]
                            <section class="action">
                                <button tabindex="100" class="primary save"><span>[@dws.txt key='form.action.savesetting' /]</span></button>
                                <a class="cancel" tabindex="101">[@dws.txt key="form.action.cancel" /]</a>
                            </section>
                        </form>
                    </div>
                </div>
            </li>
			[/#if]
        </ul>
    </div>
</section>

[/@dws.skin]

