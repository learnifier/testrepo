[#ftl strip_text="true" /]

[#macro fieldValue name]${oldValues[name]!databankValues[name]!''}[/#macro]


[#assign foot]
${cpweb_foot}
<script type="text/javascript">
    $('#tm_projects').addClass('activeItem').prev().addClass('prevItem');    

    dpSettings = {
        'defaultDate': "+1d",
        'minDate': 0,
        'showAnim': 'slideDown',
        'dateFormat': 'yy-mm-dd',
		'timeFormat': 'HH:mm',
        'showOn': "both",
        'buttonImage': "${cocoboxCdn}/cocobox/img/calendar-icon2.png",
        'buttonImageOnly': true
    };
</script>
[/#assign]


[#assign cpweb_head]

<style>
     
      #pac-input {
        background-color: #fff;
        padding: 0 11px 0 13px;
        width: 400px;
        font-family: Helvetica Neue;
        font-size: 15px;
        font-weight: 300;
        text-overflow: ellipsis;
      }

      #pac-input:focus {
        border-color: #4d90fe;
        margin-left: -1px;
        padding-left: 14px;  /* Regular padding-left + 1. */
        width: 401px;
      }

      .pac-container {
        font-family: Helvetica Neue;
        width: 200%;
      }

      #type-selector {
        color: #fff;
        background-color: #4d90fe;
        padding: 5px 11px 0px 11px;
      }

      #type-selector label {
        font-family: Helvetica Neue;
        font-size: 13px;
        font-weight: 300;
      }

</style>

<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>

 <script>

    $(document).ready(function() {
        function initialize(elementId) {
      
            var input = document.getElementById(elementId);

            var autocomplete = new google.maps.places.Autocomplete(input);

            var infowindow = new google.maps.InfoWindow();

            google.maps.event.addListener(autocomplete, 'place_changed', function() {
                infowindow.close();
                var place = autocomplete.getPlace();
                if (!place.geometry) {
                    return;
                }

                var address = '';
                if (place.address_components) {
                    address = [
                        (place.address_components[0] && place.address_components[0].short_name || ''),
                        (place.address_components[1] && place.address_components[1].short_name || ''),
                        (place.address_components[2] && place.address_components[2].short_name || '')
                    ].join(' ');
                }

                infowindow.setContent('<div><strong>' + place.name + '</strong><br>' + address);
            });

        }

        $('input[type=location]').focus(function() {
           //log('add maps to ', this.id); 
           initialize(this.id);
        });
        
        $('input[type=location]').keydown(function(event){
            if(event.keyCode == 13) {
              event.preventDefault();
              return false;
            }
        });
        
    });

 </script>


[/#assign]



[@dws.skin skin="CPAuth2" head=cpweb_head ctxMenu=cpweb_ctxMenu orgName=orgName foot=foot ]

<div style="margin: 20px 0px;">
   <input id="pac-input" class="controls" type="text" placeholder="Enter a location">
</div>


<section id="designdata">
    <h1>[@dws.txt key="cpweb.designdata.title" /]<span> ${prj.name?xhtml}</span></h1>
    <p>Bring your course to life by setting duration for activites, when a session starts and ends, the phone number for a conference call, etc...</p>

    [#global formPrefix="cpweb" /]
    <form action="${helper.urlFor('project.VerifyProjectDesignModule','updateNewDesign',[prj.projectId])}" name="createProjectGeneral" class="fullpage" method="post">
        [@mbform.alertsection]
        [/@mbform.alertsection]
        [#if errorFields?size > 0]
            <section class="alert">
              <h1>[@dws.txt key="form.alert.title" /]</h1>
              <ul>
                  <li>Check your input in the fields marked in red as the input does not match the required format.</li>
              </ul>
            </section>
        [/#if]
        
        <section class="field clearfix design">
            <ul>
                [#if components??]
                [#list components as component]
                <li class="mainitem clearfix">
                    [@displayComponent component /]
                </li>
                [/#list]
                [/#if]
            </ul>
        </section>
        [@mbform.infosection]
        [/@mbform.infosection]
        <section class="action">
            <input type="hidden" name="orgId" value="${org.id}" />
            <button type="submit" tabindex="3" class="primary save"><span>[@dws.txt key='form.action.verifyPrjDesign' /]</span></button>
            <a href="${helper.urlFor('project.ProjectModule', 'roster', [prj.projectId])}" tabindex="5" class="cancel">[@dws.txt key="form.action.cancel" /]</a>
        </section>

    </form>

</section>

[/@dws.skin]

[#macro displayComponent component]
[#if component.children?size > 0 || component.type == 'text' ]
    <div class="text">
        <h1>${component.properties.title!''}</h1>
        <p class="desc">${component.properties.description!''}</p>
    </div>
    [#if component.children?size > 0]
        [#list component.children as child]
            [#if child.properties.splitContainerPosition?? && child.properties.splitContainerPosition == "top" ]
                <div class="text">
                    [#if child.properties["title"]??]<h1>${child.properties["title"]}</h1>[/#if]
                    [#if child.properties["description"]??]<p class="desc">${child.properties["description"]}</p>[/#if]
                    [@listComponentFields child /]
                </div>
            [/#if]
         [/#list]
         <ul class="subitems">
            [#list component.children as child]
                [#if !child.properties.splitContainerPosition?? || child.properties.splitContainerPosition != "top" ]
                    <li class="subitem">[@displayComponent child /]</li>
                [/#if]
           [/#list]
        </ul>
    [/#if]
[#else]
    <div class="text">
        [#if component.properties["title"]??]<h1>${component.properties["title"]}</h1>[/#if]
        [#if component.properties["description"]??]<p class="desc">${component.properties["description"]}</p>[/#if]
        [@listComponentFields component /]
    </div>
[/#if]

[/#macro]

[#macro listComponentFields component]
[#if componentFieldSet[component.cid]??]
[#local fields = componentFieldSet[component.cid] /]
<div class="details clearfix">
    <ul>
        [#list fields as field]
        <li class="${field.name}">[@listComponentField component field /]</li>
        [/#list]
    </ul>
</div>
[/#if]
[/#macro]

[#macro listComponentField component field]
<label for="f${component.cid}_${field.name}">[@dws.txt key="cpweb.designdata.field."+field.name /]</label>
[#assign extraAttrs = "" /]
[#assign fieldType = "text"]
[#if field.name = "duration"]
  [#assign fieldType = "number"]
  [#assign extraAttrs = "min='1'" /]
[#elseif field.name = "phone"]
  [#assign fieldType = "tel"]
[#elseif field.name = "url" || field.name = "locUrl"]
  [#assign fieldType = "url"]
[#elseif field.name = "location"]
  [#assign fieldType = "location"]
[/#if]
[#assign fname = component.cid+'_'+field.name /]
<input type="${fieldType}" ${extraAttrs} id="f${component.cid}_${field.name}" name="f${component.cid}_${field.name}" value="[@fieldValue fname /]" class="[#if errorFields?seq_contains(fname)]invalid[/#if]" [#if field.mandatory]required[/#if] />
[#if field.name = "duration"]
<span style="font-weight: bold;">  min</span>
[/#if]
[#if field.dataType == "DATETIME"]
<span>  ${prj.timezone.getDisplayName(userLocale)?xhtml}</span>
[/#if]

[#if field.dataType == "DATETIME"]
[@mbform._onreadyJavascript]
[#compress]
requirejs(['jquery-ui-timepicker-addon'], function() {
	$("#f${component.cid}_${field.name}").datetimepicker(dpSettings);
});
[/#compress]
[/@]
[/#if]
[/#macro]
