[#ftl strip_text="true" /]

[#import "projectInfo.html" as pInfo /]

[#assign cpweb_head]
${cpweb_head}

<!--[if lt IE 9]>
<style>

    .toggle-button input {
        position: static; !important
    }

</style>


<![endif]-->
[/#assign]

[#assign cpweb_foot ]

${cpweb_foot}

<script>

    "use strict";
    $('#menu-projects').addClass('active');

    var settingsUrl = "${helper.urlFor('project.ProjectSettingsJsonModule', 'changeSetting',[prj.projectId])}";
    var sessionUrl = "${helper.urlFor('project.ProjectSettingsJsonModule', 'changeSetting',[prj.projectId])}";

    require(['cocobox-datetime', '${contextPath}/js/cpweb.js', 'select2-4.min', 'cocobox-editable', 'ckeditor4'], function(dt) {

        var descEditor = CKEDITOR.replace("sessionDescription"),
                updateSessionFieldUrl = "${helper.urlFor('project.session.ProjectSessionJsonModule', 'setCourseSessionField',[courseSession.id.id])}";
        descEditor.on('blur', function( evt ) {
            $.ajax({
                dataType: "json",
                method: "POST",
                url: updateSessionFieldUrl,
                data: {pk: "description", value: evt.editor.getData()}
            });
        });

        $('#visibilityMode select').select2({
            data: [{id: "hidden", text: "Hidden"}, {id: "visible", text: "Visible"}, {id: "preview", text: "Preview"}],
            allowClear: false,
            minimumResultsForSearch: Infinity
        }).val("[#if courseSession.visibility??]${courseSession.visibility.visibility}[#else]hidden[/#if]").trigger("change").ccbEditable({
            update: function (element) {
                return $.ajax({
                    dataType: "json",
                    method: "POST",
                    url: updateSessionFieldUrl,
                    data: {pk: "visibility", value: $(element).val()}
                });
            }
        });

        // Enroll section
        $('#enrollmentMode select').select2({
            data: [{id: "disabled", text: "Disabled"}, {id: "moderated", text: "Moderated"}, {id: "direct", text: "Direct"}],
            allowClear: false,
            minimumResultsForSearch: Infinity
        }).val("[#if courseSession.enrollmentSettings??]${courseSession.enrollmentSettings.mode}[#else]disabled[/#if]").trigger("change").ccbEditable({
            update: function (element) {
                return $.ajax({
                    dataType: "json",
                    method: "POST",
                    url: updateSessionFieldUrl,
                    data: {pk: "enrollmentMode", value: $(element).val()}
                });
            }
        });

        cpweb.editable($('#enrollmentFromDate .editable-content'),
                $('#enrollmentFromDate .edit '),
                function(value){},
                {type: 'date',
                    'url': updateSessionFieldUrl,
                    'pk': 'enrollmentFromDate',
                    'value': "${((session.enrollment.fromDate)?c)!''}"
                });

        $("#xxx").each(function(){
           dt.dateTime(this);
        });

        cpweb.editable($('#enrollmentToDate .editable-content'),
                $('#enrollmentToDate .edit '),
                function(value){},
                {type: 'date',
                    'url': updateSessionFieldUrl,
                    'pk': 'enrollmentFromDate',
                    'value': "${((session.enrollment.toDate)?c)!''}"
                });


        // Disenroll section
        $('#disenrollmentMode select').select2({
            data: [{id: "disabled", text: "Disabled"}, {id: "moderated", text: "Moderated"}, {id: "direct", text: "Direct"}],
            allowClear: false,
            minimumResultsForSearch: Infinity
        }).val("[#if courseSession.disenrollmentSettings??]${courseSession.disenrollmentSettings.mode}[#else]disabled[/#if]").trigger("change").ccbEditable({
            update: function (element) {
                return $.ajax({
                    dataType: "json",
                    method: "POST",
                    url: updateSessionFieldUrl,
                    data: {pk: "disenrollmentMode", value: $(element).val()}
                });
            }
        });

        cpweb.editable($('#disenrollmentFromDate .editable-content'),
                $('#disenrollmentFromDate .edit '),
                function(value){},
                {type: 'date',
                    'url': updateSessionFieldUrl,
                    'pk': 'participationexpiration',
                    'value': "${((session.disenrollment.fromDate)?c)!''}"
                });


        cpweb.editable($('#disenrollmentToDate .editable-content'),
                $('#disenrollmentFromDate .edit '),
                function(value){},
                {type: 'date',
                    'url': updateSessionFieldUrl,
                    'pk': 'disenrollmentFromDate',
                    'value': "${((session.disenrollment.toDate)?c)!''}"
                });


        require(['cocobox-togglebutton'], function(cocoboxToggle) {

            var cb = $("#participantsVisible");
            //Initialize "cb" as a toggle
            cocoboxToggle.initToggle(cb);

            //Listen on changes
            $(cb).on('CocoboxToggleChange', function(ev) {
                var buttonControl = ev.buttonControl;
                buttonControl.disable();
                $.ajax({
                    dataType: "json",
                    method: "POST",
                    url: updateSessionFieldUrl,
                    data: {pk: "participationEnabled", value: ""}
                })
                        .always(function() {
                            buttonControl.enable();
                        })
                        .done(function(data) {
                            if (data.something) {
                                buttonControl.on();
                            } else {
                                buttonControl.off();
                            }
                        });
            });
        });
    });

    var setProgressVisibility = function(visibility) {
        $.ajax({
            type: 'POST',
            url: "${helper.urlFor('project.ProjectJsonModule','setProgressVisibility',[prj.projectId])}",
            data: {enabled: visibility},
            success: function(data) {
                $('#progressVisible-cb').bootstrapToggle('enable');
                $('#progressVisible-cb').bootstrapToggle(visibility ? 'on' : 'off');
            },
            complete: function() {
                $('#progressVisible-cb').bootstrapToggle('enable');
            }
        });
    };
</script>

[/#assign]



[#assign title = (prj.name!'') + " session ("+orgName+")" /]
[@dws.skin skin="CPAuth3" head=cpweb_head ctxMenu=cpweb_ctxMenu foot=cpweb_foot orgName=title]

[@pInfo.projectInfo selected="session"][/@pInfo.projectInfo]

<section class="ccb-expandable-list">
    <h1>[@dws.txt key="cpweb.project.session.section.course.title" /]</h1>
    <div id="settingsList">
        <ul>
            <li id="courseSelector">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.course.title" /]</span>
                <select>
                    <option id="x">Select a course...</option>
                </select>
            </span>
            </li>
        </ul>
    </div>
</section>

[#if courseSession??]
<section class="ccb-expandable-list">
    <h1>[@dws.txt key="cpweb.project.session.section.information.title" /]</h1>
    <div id="settingsList">
        <ul>
            <li id="visibilityMode">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.visibility.title" /]</span>
                <select style="width: 150px"></select>
            </span>
            </li>
            <li id="description">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.description.title" /]</span>
                <textarea id="sessionDescription" class="short editable-content">
                    ${courseSession.description!''}
                </textarea>

            </span>
            </li>
        </ul>
    </div>
</section>
<section class="ccb-expandable-list">
    <h1>[@dws.txt key="cpweb.project.session.section.visibility.title" /]</h1>
    <div id="settingsList">
        <ul>
            <li id="participantsVisible">
                <div>
                    <input type="checkbox" id="participantsVisible" />
                </div>
                <a class="setting">
                    <span class="row-label">[@dws.txt key="cpweb.project.session.participantsVisible.title" /]</span>
                    [@bsform.inputBoolean 'participantsVisible' 'Visible in course catalog' 'ON' 'OFF' false?string session=formsess /]
                </a>
            </li>
            <li id="showName">
                <a class="setting">
                    <span class="row-label">[@dws.txt key="cpweb.project.session.showNames.title" /]</span>
                    [@bsform.inputBoolean 'showName' 'Show names in course catalog' 'ON' 'OFF' false?string session=formsess /] <!-- false -> something like prj.showVisible -->
                </a>
            </li>
            <li id="showThumbnails">
                <a class="setting">
                    <span class="row-label">[@dws.txt key="cpweb.project.session.showThumbnails.title" /]</span>
                    [@bsform.inputBoolean 'showThumbnails' 'Show thumbnails in course catalog' 'ON' 'OFF' false?string session=formsess /] <!-- false -> something like prj.showVisible -->
                </a>
            </li>
        </ul>
    </div>
</section>
<section class="ccb-expandable-list">
    <h1>[@dws.txt key="cpweb.project.session.section.enrollment.title" /]</h1>
    <div id="settingsList">
        <ul>
            <li id="enrollmentMode">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.enrollment.mode.title" /]</span>
                <select style="width: 150px"></select>
            </span>
            </li>
            <li>
                <input id="xxx" type="hidden">
            </li>
            <li id="enrollmentFromDate">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.enrollment.mode.title" /]</span>
                <span class="short editable-content">${(session.enrollment.fromDate)!'Click to set enrollment start date'}</span>
            </span>
            </li>
            <li id="enrollmentToDate">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.enrollment.mode.title" /]</span>
                <span class="short editable-content">${(session.enrollment.toDate)!'Click to set enrollment end date'}</span>
            </span>
            </li>
        </ul>
    </div>
</section>

<section class="ccb-expandable-list">
    <h1>[@dws.txt key="cpweb.project.session.section.disenrollment.title" /]</h1>
    <div id="settingsList">
        <ul>
            <li id="disenrollmentMode">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.disenrollment.mode.title" /]</span>
                <select style="width: 150px"></select>
            </span>
            </li>
            <li id="disenrollmentFromDate">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.disenrollment.mode.title" /]</span>
                <span class="short editable-content">${(session.disenrollment.fromDate)!'Click to set disenrollment start date'}</span>
            </span>
            </li>
            <li id="disenrollmentToDate">
            <span class="setting">
                <span class="row-label">[@dws.txt key="cpweb.project.session.disenrollment.mode.title" /]</span>
                <span class="short editable-content">${(session.disenrollment.toDate)!'Click to set disenrollment end date'}</span>
            </span>
            </li>
        </ul>
    </div>
</section>
[/#if]

[/@dws.skin]

